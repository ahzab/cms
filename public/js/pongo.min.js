Pongo.UI={$body:$(document.body),$win:$(window),$wrapper:$(".wrapper"),$container:$(".container"),$alert_box:$(".alert-msg"),$breadcrumb:$(".breadcrumb-wrapper"),$btn_clicked:null,$box_checked:null,$box_status:null,btn_text:null,lang:null,timeout:1e3,init:function(){this.loadingSpinner(),this.loadingCheckbox()},addSpin:function(){this.btn_text=this.$btn_clicked.html(),this.checkSpin()||(-1==this.btn_text.indexOf("<i")?this.$btn_clicked.prepend(Pongo.Templates.loading_tpl):this.$btn_clicked.find("i").removeClass().addClass("fa fa-refresh fa-spin"))},addShake:function(){Pongo.Form.$form.addClass("shake")},createAlertMessage:function(e){this.$alert_box.remove();var t=$("<div/>").attr("class","alert-msg").addClass(e.status).html(e.msg);"expired"==e.type?Pongo.Form.redirectTo("login"):(this.$alert_box=t,Modernizr.touch?(this.$alert_box.addClass("fixfixed"),this.$body.animate({scrollTop:0},0).prepend(t)):this.$body.prepend(t))},checkSpin:function(){return this.$btn_clicked.find("i").hasClass("fa-spin")},checkBoxSpin:function(){return this.$box_checked?this.$box_checked.next("span").find("i").hasClass("fa-spin"):!1},checkEmptyList:function(){return Pongo.Nestable.$item_list.children().html()},activePageList:function(){return Pongo.Nestable.$page_list.filter("[rel="+this.lang+"]")},loadingSpinner:function(){var e=this;$(".pongo-loading").on("click",function(t){t.preventDefault();var n=$(this);e.$btn_clicked=n,e.addSpin()})},loadingCheckbox:function(){var e=this;$(".pongo-checking").on("click",":checkbox",function(t){if(e.$box_checked=$(this),e.checkBoxSpin())t.preventDefault();else{e.$box_status=this.checked?!0:!1,e.$box_status&&t.preventDefault();var n=e.$box_checked.next("span");n.append(Pongo.Templates.loading_tpl)}})},paginateList:function(e){$.LoadNext({container:".pongo-paginating",next_link:"li:last-child a",item:e,label:Pongo.load,btn_class:"load-more",onClickNext:this.paginateSpinner,onLoadComplete:this.paginateSpinnerReset})},paginateSpinner:function(){var e=$(this);Pongo.UI.$btn_clicked=e,Pongo.UI.addSpin()},paginateSpinnerReset:function(){Pongo.UI.resetBtn()},resetCheckbox:function(){this.$box_checked.next("span").empty(),this.$box_checked.prop("checked",this.$box_status)},resetBtn:function(){var e=this;this.btn_text&&this.$btn_clicked&&(e.$btn_clicked.html(e.btn_text),e.$btn_clicked=null)},resetShake:function(){Pongo.Form.$form.removeClass("shake")},resetFieldErrors:function(){var e=Pongo.Form.$form;e.find(".form-group").removeClass("has-error"),e.find(".err").remove()}},Pongo.Block={editor:null,formatTag:function(e,t){switch(e){case"img":return'<img src="'+t+'" />';default:return t}},insertContent:function(e){this.editor.insertContent(e)},insertMarker:function(){var e=this;$(".list").on("click",".insert",function(){var t=$(this).attr("data-tag"),n=$(this).attr("data-default"),o=t?e.formatTag(t,n):n;o&&e.insertContent(o)})},settingsTinyMce:function(){var e=[],t=[];return e.toolbar="formatselect | bold italic underline strikethrough | link | bullist numlist | table | cut copy paste | fullscreen code | undo redo",t.toolbar="formatselect | bold italic  underline strikethrough | bullist numlist | link image | undo redo",e.plugins="autolink, autoresize, code, contextmenu, fullscreen, link, paste, print, table",t.plugins="autolink, autoresize, image, link",Pongo.Utils.mobileBrowser()?t:e},initTinyMce:function(e){this.editor=e}},Pongo.Factory={url:null,tpl:null,createPage:function(){var e=this;$("#create-page").on("click",function(t){t.preventDefault(),e.tpl=Pongo.Templates.new_page_tpl,e.url=Pongo.Utils.url("api/page/create"),e.sendRequest({lang:Pongo.UI.lang})})},createRole:function(){var e=this;$("#create-role").on("click",function(t){t.preventDefault(),e.tpl=Pongo.Templates.new_role_tpl,e.url=Pongo.Utils.url("api/role/create"),e.sendRequest(null)})},createUser:function(){var e=this;$("#create-user").on("click",function(t){t.preventDefault(),e.tpl=Pongo.Templates.new_user_tpl,e.url=Pongo.Utils.url("api/user/create"),e.sendRequest(null)})},processResponse:function(e){if("success"==e.status){var t=(Pongo.UI.activePageList(),_.template(this.tpl)),n=t(e);"page"==e.render&&this.renderNewPage(n),"role"==e.render&&this.renderNewRole(n),"user"==e.render&&this.renderNewUser(n),Pongo.UI.createAlertMessage(e,null,null)}},renderNewPage:function(e){var t=Pongo.UI.activePageList();t.find("a.new").removeClass("new"),t.children().prepend(e),t.nestable("serialize")},renderNewRole:function(e){var t=Pongo.Nestable.$item_list;t.children().append(e),t.nestable("serialize")},renderNewUser:function(e){var t=Pongo.Nestable.$item_list;t.children().first().prepend(e),t.nestable("serialize")},sendRequest:function(e){this.url?$.ajax({type:"POST",url:this.url,data:e,success:this.processResponse,context:this,dataType:"json"}).done(function(){Pongo.UI.resetBtn()}):console.log("No this.url")}},Pongo.Form={url:null,redirect_uri:null,$form:null,$modal:null,$item:null,init:function(){this.confirmDialog(),this.submitAjax(),this.submitForm(),console.log("init Form")},confirmDialog:function(){var e=this;$(".pongo-confirming").on("click",".pongo-confirm",function(t){t.preventDefault();var n=$(this),o=n.data("id");e.$item=n.parents("li").filter("[data-id="+o+"]"),e.$modal=$(n.data("target")),e.$modal.find("input[name=item_id]").val(o)})},submitForm:function(){var e=this;$(".pongo-form-submit").on("click",function(t){t.preventDefault();var n=$(this);e.$form=n.parents("form"),e.$form.submit()})},submitAjax:function(){var e=this;$(".pongo-ajax-submit").on("click",function(t){t.preventDefault();var n=$(this);e.$form=n.parents("form"),Pongo.UI.resetShake(),e.url=e.$form.attr("action"),e.sendRequest()})},sendRequest:function(){this.url?$.ajax({type:"POST",url:this.url,data:this.$form.serialize(),success:this.validateForm,context:this,dataType:"json"}).done(function(){Pongo.UI.resetBtn()}):console.log("No this.url")},fieldErrors:function(e){Pongo.UI.addShake(),$.each(e,function(e,t){$item=$(".form-group[rel="+e+"]"),$item.find(".help-block").remove(),$item.addClass("has-error"),$item.children("label[for="+e+"]").append('<span class="err"> - '+t+"</span>")})},redirectTo:function(e){window.location=Pongo.Utils.url(e)},redirectUrl:function(e){window.location=e},removeListItem:function(){var e=this.$item.parent();this.$item.remove(),e.html().trim()||e.append(Pongo.Templates.empty_tpl),this.$modal.modal("hide")},validateForm:function(e){Pongo.UI.resetFieldErrors(),e.errors&&this.fieldErrors(e.errors),e.redirect&&this.redirectUrl(e.route),e.remove&&this.removeListItem(e.remove),"error"==e.status&&Pongo.UI.addShake(),e.msg&&Pongo.UI.createAlertMessage(e)}},Pongo.Nestable={$page_list:$(".dd"),$item_list:$(".dl"),$item_moved:null,$spinner_holder:null,dropped_id:null,dropped_class:null,init:function(){this.pageList(),this.pageExpColl()},checkSpin:function(){return this.$spinner_holder.hasClass("fa-spin")},pageExpColl:function(){var e=this;$(".page-controls").on("click",function(t){var n=$(t.target),o=n.data("action");"expand-all"===o&&e.$page_list.nestable("expandAll"),"collapse-all"===o&&e.$page_list.nestable("collapseAll")})},pageList:function(){var e=this,t=e.$page_list.hasClass("pongo-moving");e.$page_list.nestable({dropCallback:function(n,o){e.$item_moved=o,e.reorderItem(n,"a > i",t)}}).on("reorder",function(){var n=e.$page_list.filter("[rel="+Pongo.UI.lang+"]");e.reorderItemPost(n,"api/page/move",t)})},roleList:function(){var e=this,t=e.$item_list.hasClass("pongo-moving");e.$item_list.nestable({maxDepth:0,rootClass:"dl",listClass:"dl-list",notClass:"dl-not",itemClass:"dl-item",dragClass:"dl-dragel",dropCallback:function(n,o){e.$item_moved=o,e.reorderItem(n,".fa-pencil-square-o",t)}}).on("reorder",function(){var n=e.$item_list;e.reorderItemPost(n,"api/role/move",t)})},reorderItem:function(e,t,n){this.dropped_id=e,n&&this.reorderItemLoading(t)},reorderItemLoading:function(e){this.dropped_id;this.$spinner_holder=this.$item_moved.find(e);var t=this.$spinner_holder;this.dropped_class=t.attr("class"),this.checkSpin()?(this.$spinner_holder.removeClass().addClass(this.dropped_class),t.removeClass().addClass("fa fa-refresh fa-spin")):t.removeClass().addClass("fa fa-refresh fa-spin")},reorderItemReset:function(){var e=(this.dropped_id,this.$spinner_holder);e.removeClass().addClass(this.dropped_class)},reorderItemPost:function(e,t,n){var o=this,i=o.reorderStringify(e);$.post(Pongo.Utils.url(t),{items:i},function(e){Pongo.UI.createAlertMessage(e,null,null)},"json").done(function(){n&&o.reorderItemReset()})},reorderStringify:function(e){if(JSON&&e){var t=e.nestable("serialize");return JSON.stringify(t)}var n={status:"error",msg:"Unsupported browser!"};Pongo.UI.createAlertMessage(n,null,null)}},Pongo.Templates={empty_tpl:"<li><p>"+Pongo.noresult+'</p><label class="fake"></label></li>',loading_tpl:'<i class="fa fa-refresh fa-spin"></i> ',new_role_tpl:'<li class="dl-item move" data-id="<%= id %>"><p class="dd-handle"><%= name %></p><label><input type="checkbox" value="<%= id %>" class="pongo-checkbox"><span></span></label><div class="btn-edit"><a href="<%= url_edit %>" class="btn btn-sm btn-primary"><i class="fa fa-pencil-square-o"></i></a>\n<a href="#" data-toggle="modal" data-target=".pongo-delete" data-id="<%= id %>" class="btn btn-sm btn-danger pongo-confirm"><i class="fa fa-trash-o"></i></a></div></li>',new_page_tpl:'<li class="dd-item" data-id="<%= id %>"><p class="dd-handle"><%= name %></p><label><input type="checkbox" value="<%= id %>" class="pongo-checkbox"><span></span></label><a href="<%= url %>" class="<%= cls %>"><i class="fa fa-chevron-right"></i></a></li>',new_user_tpl:'<li class="dl-item" data-id="<%= id %>"><p class="dd-handle"><%= username %></p><label><input type="checkbox" value="<%= id %>" class="pongo-checkbox"><span></span></label><div class="btn-edit"><a href="<%= url_edit %>" class="btn btn-sm btn-primary"><i class="fa fa-pencil-square-o"></i></a>\n<a href="#" data-toggle="modal" data-target=".pongo-delete" data-id="<%= id %>" class="btn btn-sm btn-danger pongo-confirm"><i class="fa fa-trash-o"></i></a></div></li>',new_block_tpl:"<li></li>"},Pongo.Toggle={$change_lang:$("#change-lang"),init:function(){this.togglePages(),this.toggleOptions(),this.toggleLang(),this.toggleSearch(),this.toggleValid()},toggleValid:function(){$(".pongo-active").on("click",".pongo-checkbox",function(e){var t=$(this);if(Pongo.UI.checkBoxSpin()&&Pongo.UI.$box_checked!=t&&Pongo.UI.resetCheckbox(),Pongo.UI.$box_checked=t,Pongo.UI.checkBoxSpin())e.preventDefault();else{var n=t.val(),o=this.checked?1:0,i=t.parents("form").attr("action");$.post(i,{item_id:n,action:o},function(){},"json").done(function(){Pongo.UI.resetCheckbox()})}})},toggleLang:function(){var e=this;Pongo.UI.lang=this.$change_lang.val(),Pongo.UI.activePageList().show(),this.$change_lang.on("change",function(){Pongo.UI.lang=e.$change_lang.val(),Pongo.Nestable.$page_list.hide(),Pongo.UI.activePageList().show(),$.post(Pongo.Utils.url("api/page/lang"),{lang:Pongo.UI.lang},function(e){$(".breadcrumb > li").first().html(Pongo.UI.lang.toUpperCase()),Pongo.UI.createAlertMessage(e,null,null)},"json")})},toggleOptions:function(){$(".options-toggle").on("click",function(e){e.preventDefault(),Pongo.UI.$body.toggleClass("push-left")})},togglePages:function(){$(".pages-toggle").on("click",function(e){e.preventDefault(),Pongo.UI.$body.hasClass("push-left")&&Pongo.UI.$body.removeClass(),Pongo.UI.$body.toggleClass("push-right")})},toggleSearch:function(){$(".search-toggle").on("click",function(e){e.preventDefault(),Pongo.UI.$breadcrumb.toggleClass("open-search")})}},Pongo.Utils={mobileBrowser:function(){return jQuery.browser.mobile?!0:!1},url:function(e){return Pongo.base+"/"+e}},function(){Pongo.UI.init(),console.log("pongo.js loaded and minified!",new Date)}.call(this);